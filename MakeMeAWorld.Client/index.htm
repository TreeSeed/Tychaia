<!DOCTYPE html> 
<html>
  <head>
    <title>Make me a world with Tychaia!</title>
    
    <link rel="stylesheet" href="browser.css">
    <link rel="stylesheet" href="platformer.css">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  </head>
  <body onload="onLoad()">
    <script type="text/javascript">
      var jsilConfig = {
        manifests: [
          "Tychaia/TychaiaWorldGenWebsite.dll",
        ],
        
        showProgressBar: true,
        getProgressContainer: function()
        {
            return document.getElementById("welcomeMessage");
        },

        scriptRoot: "Tychaia/",
        libraryRoot: "Libraries/",
        fileRoot: "Content/",
        contentRoot: "Content/"      
      };
    </script>
    <script src="Libraries/JSIL.js" type="text/javascript"></script>  
    <script src="Tychaia/WorldConfig.js" type="text/javascript"></script>  
    <script src="Tychaia/RandomSupport.js" type="text/javascript"></script>    
    
    <div style="margin: auto; width: 1280px; position: relative;">
        <h1 style="text-align: center;">Make me a world with <a href="http://tychaia.com/">Tychaia</a>!</h1>
    
        <div style="position: relative;">
            <canvas id="canvas" width="1280" height="720">
            </canvas>
            <div id="welcomeMessage">
                <p>On this site you can use the Tychaia world generation to create an 2D or 3D rendering of a Tychaia world
                in your browser.  <strong><em>This does not yet load the actual generator!</em></strong></p>
                <p>Since this is C# converted to Javascript, it'll take a little while to start before it gets going.  We
                realise that the actual generation itself is pretty slow, due to the emulation of 64-bit integer operations
                in Javascript.  We will be addressing this issue in future.</p>
                <button id="loadButton">Make me a world!</button>
            </div>
        </div>
        
        <div style="font-size: 14px; text-align: center; margin-top: 12px;">
            Generated by <a href="http://tychaia.com/">Tychaia</a>.  Powered by <a href="http://jsil.org/">JSIL</a>.
        </div>
        
        <script type="text/javascript">
          function runMain () {
            try {
              document.getElementById("welcomeMessage").setAttribute("style", "display: none");
            } catch (ex) {
            }

            // Invoke the library calls.
            var asm_site = JSIL.GetAssembly("TychaiaWorldGenWebsite");
			var asm_lib = JSIL.GetAssembly("Tychaia.ProceduralGeneration");
			var layer = loadConfig(asm_lib, Math.floor((Math.random()*10000000)+1));
            var x = 0;
            var y = 0;
            var func = function()
            {
                asm_site.Program.Main(x, y, 16, 16, layer);
                x += 16;
                if (x >= document.getElementById("canvas").width)
                {
                    x = 0;
                    y += 16;
                }
                if (y < document.getElementById("canvas").height)
                    window.setTimeout(func, 1);
            };
            window.setTimeout(func, 1);
          };
        </script>
    </div>
  </body>
</html>
